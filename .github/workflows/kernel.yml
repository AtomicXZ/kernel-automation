name: Automate Kernel building

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  branch: "Q-rb"
  username: "AtomicXZ"  
  repo: "kernel_xiaomi_phoenix"

jobs: 
  build:
    runs-on: ubuntu-latest

    steps:
       - name: Checkout
         uses: actions/checkout@master

       - name: Clean Up
         run: |
           docker rmi `docker images -q`
           sudo rm -rf /usr/share/dotnet /etc/mysql /etc/php /etc/apt/sources.list.d
           sudo -E apt-get -y purge azure-cli ghc* zulu* hhvm llvm* firefox google* dotnet* powershell openjdk* mysql  php*
           sudo -E apt-get update
           sudo -E apt-get -y autoremove --purge
           sudo -E apt-get clean
           
       - name: Setup environment
         run; |
           sudo apt-get -y install bc build-essential zip curl libstdc++6 git wget python gcc clang libssl-dev repo rsync flex bison cpio
       
       - name: Downloading script from github repo
         run: |
           wget https://raw.githubusercontent.com/$username/$repo/$branch/build.sh
           bash build.sh
